$.fn.isOnScreen=function(){var t=$(window),i={top:t.scrollTop(),left:t.scrollLeft()};i.right=i.left+t.width(),i.bottom=i.top+t.height();var e=this.offset();return e.right=e.left+this.outerWidth(),e.bottom=e.top+this.outerHeight(),!(i.right<e.left||i.left>e.right||i.bottom<e.top||i.top>e.bottom)},$(function(){function t(t){this.option=$.extend({position:0,interval:6e3},t),this.init()}function i(t,i,e){var o=new Image;o.onload=i,o.onerror=e,o.src=t}function e(){var t=navigator.userAgent,i=t.indexOf("compatible")>-1&&t.indexOf("MSIE")>-1,e=t.indexOf("Edge")>-1&&!i,o=t.indexOf("Trident")>-1&&t.indexOf("rv:11.0")>-1;if(i){var a=new RegExp("MSIE (\\d+\\.\\d+);");a.test(t);var n=parseFloat(RegExp.$1);return 7==n?7:8==n?8:9==n?9:10==n?10:6}return e?"edge":o?11:-1}var o=$(document);VIVO_UI.HighLightNav(0),$.extend(t.prototype,{init:function(){var t=this,i=this.option.$thumbs.parent().parent()[0];this.time=0,this.option.$thumbs.on("click",function(){var i;t.locked||(i=$(this).index(),t.option.position!==i&&t.goto(i))}),i.onmouseenter=function(){t.stop()},i.onmouseleave=function(){t.start()}},"goto":function(t){var i,e,o=this;this.locked||(this.locked=!0,this.time=0,i=this.option.$items.eq(t),e=this.option.$items.eq(this.option.position),this.option.$thumbs.removeClass("current").eq(t).addClass("current").end().eq(this.option.position).find(".progress").css("width",0),this.option.position=t,i.addClass("show").css({opacity:0}).animate({opacity:1},1e3,function(){e.removeClass("current"),i.removeClass("show").addClass("current"),o.locked=!1}),$(".banner").isOnScreen()&&Vtrack.clickStats({cfrom:5116,pageview:"商城首页",position:t+1,name:i.attr("data-name")}))},start:function(){var t=this;this.intervalId=setInterval(function(){t.time+=window.isIE8?100:50,t.time>t.option.interval&&(t.time=t.option.interval),t.option.$thumbs.eq(t.option.position).find(".progress").css("width",100*t.time/t.option.interval+"%"),t.time===t.option.interval&&t.goto((t.option.position+1)%t.option.$thumbs.length)},window.isIE8?100:50)},stop:function(){clearInterval(this.intervalId)}}),function(){var e=$(".banner .img-list").children(),o=$(".banner .thumb-list").children(),a=e.filter(".current")[0];e.each(function(){var n=$(this),r=n.find("img");i(r.attr("src"),function(){n.removeClass("loading"),r.css("visibility","visible"),e.length>1&&n[0]===a&&new t({$items:e,$thumbs:o}).start()},function(){n.removeClass("loading").addClass("error"),e.length>1&&n[0]===a&&new t({$items:e,$thumbs:o}).start()})})}(),function(){$(".floor-list").on("click",".color-list li",function(){var t,e,o,a,n,r=$(this);r.hasClass("selected")||(t=r.parent(),e=r.attr("data-img"),o=r.attr("data-href"),r.addClass("selected").siblings().removeClass("selected"),n=t.parent().prev().attr("href",o).children().eq(1),t.next().find(".prompt").text("已选："+t.attr("data-name")+" "+r.attr("title")),a=t.next().next().children().eq(0).attr("href",o).next(),a.attr("class","btn").removeAttr("href").addClass(["sellout","putin-shopcart","full-book"][r.attr("data-saleable")]),"2"===r.attr("data-saleable")&&a.attr("href",o),"load"===r.data("complete")?n.clone().attr("src",e).css({marginTop:-n.height(),opacity:0,visibility:"visible"}).appendTo(n.parent()).animate({opacity:1},function(){r[0]===r.parent().children(".selected")[0]&&(n.attr("src",e).css("visibility","visible").prev().addClass("hide"),n.nextAll().remove())}):"error"===r.data("complete")?n.prev().clone().addClass("error").removeClass("hide").css({position:"relative",display:"inline-block",marginTop:-n.height(),opacity:0}).appendTo(n.parent()).animate({opacity:1},function(){r[0]===r.parent().children(".selected")[0]&&(n.css("visibility","hidden").prev().addClass("error").removeClass("hide"),n.nextAll().remove())}):n.prev().clone().removeClass("error hide").css({position:"relative",display:"inline-block",marginTop:-n.height(),opacity:0}).appendTo(n.parent()).animate({opacity:1},function(){i(e,function(){r.data("complete","load"),r[0]===r.parent().children(".selected")[0]&&(n.attr("src",e).css("visibility","visible").prev().addClass("hide"),n.nextAll().remove())},function(){r.data("complete","error"),r[0]===r.parent().children(".selected")[0]&&(n.css("visibility","hidden").prev().addClass("error").removeClass("hide"),n.nextAll().remove())})}))})}(),function(){$(".fp .box > a > img, .p_3 .box > a > img, .pc_6 .box:first-child > a > img").each(function(){var t=$(this);i(t.attr("src"),function(){t.css({visibility:"visible"}).prev().addClass("hide")},function(){t.prev().addClass("error")})}),$(".color-list li:first-child").trigger("click")}(),window.onload=function(){$(".color-list li").each(function(){var t=$(this);i(t.attr("data-img"),function(){t.data("complete","load")},function(){t.data("complete","error")})})},function(){function t(t){var i=t[0].getBoundingClientRect(),e=n[0].getBoundingClientRect(),r=t.clone().css("visibility","visible").appendTo(document.body);r.css({position:"fixed",zIndex:"9999",left:i.left,top:i.top,width:i.right-i.left,height:i.bottom-i.top}).animate({width:50,height:50,left:(i.left+i.right)/2-25,top:(i.top+i.bottom)/2-25},function(){$(this).dequeue("verticalMove")}).animate({left:e.left},600,"linear").animate({top:e.top},{queue:"verticalMove",duration:600,easing:"easeInQuint",complete:function(){r.remove(),2===++a&&(o.trigger("updateShopcartNum"),n.trigger("click",[!0]))}})}var i,e,a,n=$("#side-bar .shopcart");$(".floor-list").on("click",".putin-shopcart",function(){var r,c=i;void 0!==e&&clearTimeout(e),i=(new Date).getTime(),e=setTimeout(function(){i=void 0},500),void 0===c&&(a=0,r=$(this).parent(),$.ajax({type:"post",url:"/shoppingcart/cartAdd",data:{skuId:r.siblings(".color-list").find(".selected").attr("data-skuid"),num:1,needCheck:1},dataType:"json",success:function(t,i){"success"===i&&200===t.retCode&&2===++a&&(o.trigger("updateShopcartNum"),n.trigger("click",[!0]))}}),t(r.parent().prev().children().last()))})}(),$.ajax({type:"get",dataType:"json",url:webCtx+"/bag/index",success:function(t){if(t&&200==t.retCode&&t.homeBag){var i=window.localStorage.getItem("bagFlag"),o=t.homeBag,a=1,n=o.bagPcUrl.split("/").pop().split("?")[0];"00"==o.bagStatus&&($(document.body).append($("#newbieTpl").html()),$(".dialog-gift .dialog-img").attr("src",IMGHOSTURL+o.bagImg.pcLayerUrl),$(".popup-gift img").attr("src",IMGHOSTURL+o.bagImg.pcFixUrl),1==i&&(a=2,$(".dialog-gift").animate({left:"-100%"},0).find("img"),$(".popup-gift").animate({opacity:1,transform:"scale(1.2)"},1e3,function(){$(".popup-gift").animate({transform:"scale(1.1)"},1e3)})),Vtrack.clickStats({cfrom:"5130",pageview:"商城首页",pkg_id:n,type:a})),$(".dialog-gift .dialog-img").click(function(){LoginConfirm.isLogin()?window.location.href=o.bagPcUrl+"?source=1":LoginConfirm.redirect(o.bagPcUrl+"?source=1"),Vtrack.clickStats({pageview:"商城首页",cfrom:5129,pkg_id:n,type:1})}),9==e()?($(".dialog-gift i").on("click",function(){$(".dialog-gift i").hide(),$(".dialog-gift").hide(),$(".popup-gift").show().css({opacity:1}),window.localStorage.setItem("bagFlag","1")}),$(".popup-gift").on("click",function(){$(".dialog-gift i").show(),$(".popup-gift").hide(),$(".dialog-gift").show().css({left:"50%"}),Vtrack.clickStats({pageview:"商城首页",cfrom:5129,pkg_id:n,type:2})})):($(".dialog-gift i").on("click",function(){$(".dialog-gift i").hide(),$(".dialog-gift").removeClass("dGoSmall addg0 dGoBig addg1").addClass("dGoSmall addg0"),window.localStorage.setItem("bagFlag","1"),setTimeout(function(){$(".popup-gift").addClass("pGoBig addp2")},700)}),$(".popup-gift").on("click",function(){$(".dialog-gift i").show(),$(".popup-gift").removeClass("pGoBig addp2").addClass("pGoSmall addp0"),setTimeout(function(){$(".dialog-gift").removeClass("dGoSmall addg0").addClass("dGoBig addg1")},40),Vtrack.clickStats({pageview:"商城首页",cfrom:5129,pkg_id:n,type:2})}))}},error:function(){}})}),$(function(){"undefined"!=typeof ISHOMEHEAD&&ISHOMEHEAD||$(".nav-gb").eq(0).find("a").addClass("current"),Vtrack(function(){this.clickStats({cfrom:5100,pageview:"商城首页",cid:Vtrack.getLocalData("vfe-cid")||"",is_done:1}),$(window).on("beforeunload",function(){Vtrack.clickStats({cfrom:5100,pageview:"商城首页",lefttime:+new Date})})},function(){console.warn("失败")}),$("a.logo").on("click",function(){Vtrack.clickStats({cfrom:5111,pageview:"商城首页",name:"商城logo"})}),$("a.help").on("click",function(){Vtrack.clickStats({cfrom:5109,pageview:"商城首页",name:"帮助中心"})}),$(".shopcart-fixbox").on("click",".clearing",function(){Vtrack.clickStats({cfrom:5110,pageview:"商城首页",name:"购物车立即结算"})}),$(".promise a").on("click",function(){var t=$(this).index()+1;Vtrack.clickStats({cfrom:5112,pageview:"商城首页",position:t,name:"信任图标"})}),$(".vvs-agree-item a").on("click",function(){var t=$(this).parent().index()+1;Vtrack.clickStats({cfrom:5112,pageview:"商城首页",position:t,name:"信任图标"})});var t=1;$(window).on("scroll",function(){var i=$(".img-list"),e=i.isOnScreen();if(e||(t=1),e&&t){var o=i.find(".current"),a=o.attr("data-name"),n=o.index()+1;Vtrack.clickStats({cfrom:5116,pageview:"商城首页",position:n,name:a}),t=0}}).trigger("scroll"),$(".img-list li").on("click",function(){var t=$(this).index()+1,i=$.trim($(this).attr("data-name"));Vtrack.clickStats({cfrom:5113,pageview:"商城首页",position:t,name:i})}),$("#side-bar").on("mouseup","li",function(){var t=$(this).attr("class"),i=3;switch(t){case"shopcart":i=1;break;case"service":i=2;break;case"feedback":i=4;break;case"backtop":i=5}Vtrack.clickStats({cfrom:5121,pageview:"商城首页",name:"浮动图标",position:i})}),$(".more-wrapper").on("click","a",function(){var t=$(this).parent(),i=t.parent().children().length,e=t.index(),o=$.trim(t.text()),a=$.trim(t.closest(".info").find(".subject").text()),n=i-e;Vtrack.clickStats({cfrom:"5120",pageview:"商城首页",name:o,position:n,source:a})});var i=$(".fp .box"),e=Array.apply(null,Array(i.length)).map(function(){return 1});$(window).on("scroll",function(){i.each(function(t){var i=$(this),o=i.isOnScreen();if(o||(e[t]=1),o&&e[t]){var a=$(this).children().eq(0)[0].href;Vtrack.clickStats({cfrom:5115,pageview:"商城首页",position:i.index()+1,name:a}),e[t]=0}})}).trigger("scroll"),$(".fp").on("click","a",function(){var t=this.href;Vtrack.clickStats({pageview:"商城首页",cfrom:5114,name:t,position:$(this).parent().index()+1})});var o=$(".floor").not(".fp").find(".box"),a=Array.apply(null,Array(o.length)).map(function(){return 1});$(window).on("scroll",function(){o.each(function(t){var i=$(this),e=i.isOnScreen();if(e||(a[t]=1),e&&a[t]){var o=$.trim(i.closest(".floor").find(".subject").text()),n=i.children().eq(0).attr("data-name"),r=i.index()+1,c=i.children().eq(0)[0].href.match(/product\/(\w+)[\?]?/i),s=c?c[1]:"";Vtrack.clickStats({cfrom:5117,pageview:"商城首页",goodid:s,position:r,source:o,name:n}),a[t]=0}})}).trigger("scroll"),$(".floor").not(".fp").on("click",'.box a:not(".sellout")',function(){var t=$(this),i=$.trim(t.closest(".floor").find(".subject").text()),e=t.closest(".box").children().eq(0).attr("data-name"),o=t.closest(".box").index()+1,a="5118";if(t.hasClass("putin-shopcart")){a="5119";var n=t.data().spustr.match(/product\/(\w+)[\?]?/i),r=n?n[1]:""}else var n=this.href.match(/product\/(\w+)[\?]?/i),r=n?n[1]:"";Vtrack.clickStats({pageview:"商城首页",cfrom:a,goodid:r,position:o,source:i,name:e})})});